C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          
   2          /*-----------------07ÑÓÊ±³ÌÐò--------------
   3          C8051F340£¬ÏµÍ³Ê±ÖÓÎª12M
   4          ¹¦ÄÜ1£ºÊµÏÖÈýÏà½»Á÷µ÷Ñ¹
   5          ¹¦ÄÜ2£º²É¼¯A,BÁ½ÏàADCÊý¾Ý£¬Í¨¹ýLCDÏÔÊ¾
   6          *¡-----------------------------------------*/
   7          #include "c8051f340.h"
   8          #include <INTRINS.H>
   9          #include "var.h"
  10          #include "lcd.c"
  11          //-------------------Ö÷³ÌÐò---------------------
  12          void main(void)               
  13          { 
  14   1        EA=0; EMI0CF=EM_DATA;
  15   1        PCA0MD=0;        //¹Ø±ÕWDT 
  16   1        osc_init();      //Õñµ´Æ÷³õÊ¼»¯ 
  17   1        tzd();tzd();     //¸´Î»ÖÐ¶Ï
  18   1        wdt_initi();     //¿´ÃÅ¹·³õÊ¼»¯º¯Êý
  19   1        vdd_rst_init();  //³õÊ¼»¯¸´Î»Ô´¡¢Æð¶¯Ê±ÖÓ¶ªÊ§¼ì²â¡¢vdd¼àÊÓ¸´Î»   
  20   1        port_initi();    //io¿Ú³õÊ¼»¯
  21   1        chufa_off();  //¹Ø±Õ¶Ë¿Ú¡¢Çå´¥·¢±êÖ¾ 
  22   1        if((RSTSRC&1<<PORSF)==0)    re_hf=1;   //ÖÃÈÈ»Ö¸´±êÖ¾
  23   1        else                       {zt=0x55;re_hf=0;PCON=0;}  // ÀäÆô¶¯
  24   1      
  25   1        if(re_hf==0&&zt==0x55)  leng();  //ÀäÆô¶¯\lcd³õÊ¼»¯
  26   1          
  27   1        while(1)
  28   1        {switch(zt)
  29   2         {case 0x5a: start_cl(); break; //µ÷Ñ¹×´Ì¬  
  30   3          default:   stop_cl();         //Í£³µ×´Ì¬
  31   3         }             
  32   2        }
  33   1      }
  34          
  35          
  36          //-----------------------------------
  37          /*--------aÏàµçÁ÷Í¬²½ÖÐ¶Ï--------------*/                                   
  38          void int0(void) interrupt 0        
  39          {
  40   1          
  41   1          
  42   1      }
  43          //----------------------------------------
  44          /*--------¿Õ--------------*/
  45          void int1(void) interrupt 2         
  46          { 
  47   1        
  48   1      }
  49          
  50          /*--------aÏà¶¨Ê±Æ÷ÖÐ¶Ï------------*/  //¶¨Ê±Æ÷0
  51          void time_ax(void) interrupt 1  
  52          { 
  53   1        
  54   1        
  55   1      
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 2   

  56   1      }                                
  57          /*--------bÏà¶¨Ê±Æ÷ÖÐ¶Ï------------*/  //¶¨Ê±Æ÷1
  58          void time_bx(void) interrupt 3  
  59          {
  60   1        
  61   1      }
  62          
  63          
  64          /*--------cÏà¶¨Ê±Æ÷ÖÐ¶Ï------------*/ //¶¨Ê±Æ÷2
  65          void time_cx(void) interrupt 5  
  66          { 
  67   1        
  68   1      }
  69          
  70          
  71          /*--------pcaÖÐ¶Ïa,b,cµçÑ¹Í¬²½¼°------
  72          ----------cµçÁ÷Í¬²½---------*/    //PCAÖÐ¶Ï
  73          void pca(void)  interrupt 11       
  74          {if(_testbit_(CCF2))  //CÏàµçÁ÷Í¬²½
  75   1        {
  76   2      
  77   2        }
  78   1      //-------------------------------------------------------------
  79   1       else if(_testbit_(CCF0))  //BÏàµçÑ¹Í¬²½(ÆäËüÒÔ´ËÎª»ù×¼¡¢ÏÂ½µÑØÓÐÐ§£©
  80   1        {
  81   2      
  82   2        }
  83   1      //-------------------------------------------------------------
  84   1       else if(_testbit_(CCF3))  //3.333ms¶¨Ê±
  85   1        {
  86   2      
  87   2        }
  88   1      //---------------------------------------------------------
  89   1       else if(_testbit_(CCF1))    //bÏàµçÁ÷Í¬²½
  90   1        {
  91   2          
  92   2        } 
  93   1       else 
  94   1        {}  //¶¼²»ÊÇ·µ»Ø
  95   1      }
  96          
  97          
  98          //¡ª¡ª-------t3¶¨Ê±ÖÐ¶Ï ´¥·¢Âö³åÁÐ-------------
  99          void ds_1ms(void) interrupt 14     //110us+57us¶¨Ê±*6=1ms
 100           {  
 101   1         uchar data temp;
 102   1         static uchar data vp_js,yc,dl_max,adc_js;
 103   1         static uint data dl_a,dl_b;
 104   1         
 105   1      
 106   1         if(cfmc_jx==1) //Âö³å´®Êä³ö¸ßµçÆ½110us£¬ÏÂ´Î½øÈëÖÜÆÚ166.6us
 107   1           {cfmc_jx=0;
 108   2            
 109   2          //--Æð¶¯adcÅÐ¶Ï-----------------
 110   2          if(adc_t3>39)    adc_t3=0;  //Êý×é±äÁ¿
 111   2          if(++adc_js>5)   adc_js=0;
 112   2           switch(adc_js)    //Ã¿´Î167usÖ´ÐÐÒ»¸ö
 113   2               {case 0:     
 114   3                   dl_a=adc_start(AX_ADC,RIGHT); //²ÉÑùAµçÁ÷
 115   3                   dl_b=adc_start(BX_ADC,RIGHT); //²ÉÑùBµçÁ÷
 116   3                  break;                    
 117   3               case 1: 
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 3   

 118   3                  break;
 119   3               case 2:   //---ÕÒ×î´óÖµ---------------
 120   3                    temp=dl_a>>8;
 121   3                    if(temp>dl_max)  dl_max=temp;
 122   3                    temp=dl_b>>8;
 123   3                    if(temp>dl_max)  dl_max=temp;       
 124   3                    break ;     
 125   3               case 3: 
 126   3                  switch(adc_amp)   //---------µçÁ÷·ÅÈë¶ÓÁÐ--------------------
 127   3                     {case 0:
 128   4                         ax_dl[adc_t3]=dl_a<<2;//2±¶ÔöÒæÊ±Êý¾Ý·Å´ó
 129   4                         bx_dl[adc_t3]=dl_b<<2;     
 130   4                         break;  
 131   4                      case 1:
 132   4                         ax_dl[adc_t3]=dl_a<<1;//4±¶ÔöÒæÊ±Êý¾Ý·Å´ó
 133   4                         bx_dl[adc_t3]=dl_b<<1;
 134   4                         break;  
 135   4                      case 2:
 136   4                        ax_dl[adc_t3]=dl_a;//8±¶ÔöÒæ²»±ä  
 137   4                        bx_dl[adc_t3]=dl_b;
 138   4                        break;              
 139   4                      default: ;
 140   4                     }      
 141   3                   break; 
 142   3               case 4:
 143   3                  if(++vp_js>20)   //20msÔöÒæ¸Ä±äÒ»´Î ·åÖµ±£³ÖÇåÁã
 144   3                     { //----ÅÐ¶ÏÔöÒæ Ôö¼Ó»¹ÊÇ¼õÉÙ----
 145   4                      if(dl_max>=3)
 146   4                         {if(--adc_amp>0x80) adc_amp=0;}//´óÓÚ0x300¼õÐ¡ÔöÒæ
 147   4                      else if(dl_max<1)
 148   4                         {if(++adc_amp>2)    adc_amp=2;}  //Ð¡ÓÚ0x100¼Ó´óÔöÒæ 
 149   4                      else  ;
 150   4                        //----µ÷ÕûÔöÒæ---- G=0,S=0---4±¶
 151   4                        //---------------------G=0,S=1---2±¶
 152   4                        //---------------------------G=1 S=1---8±¶
 153   4                        switch(adc_amp)
 154   4                         {case 0:  CS4053=0; TD4053=1; break;   //2±¶ÔöÒæ //0,1
 155   5                          case 1:  CS4053=0; TD4053=0; break;   //4±¶ÔöÒæ //0,0  
 156   5                          case 2:  CS4053=1; TD4053=1; break;   //8±¶ÔöÒæ //1,1                 
 157   5                          default: adc_amp=0;CS4053=0; TD4053=1; //2±¶ÔöÒæ //0,1
 158   5                         }      
 159   4                        vp_js=0;dl_max=0;   //·åÖµ±£³ÖÇåÁã    
 160   4                       }                 
 161   3                    break; 
 162   3               case 5: adc_t3++;   //1msÖ´ÐÐÒ»´Î  
 163   3                   break;
 164   3                                   
 165   3               default: ;
 166   3             } 
 167   2            if(++yc>=15) {yc=0;time_2500us++;}
 168   2            TMR3CN=0;
 169   2            TMR3RLL=0XD2;TMR3RLH=0XFF;    //µÍµçÆ½¶¨Ê±46us£¨Ð´Èë×°ÔØ¼Ä´æÆ÷ ÖÐ¶Ïºó´ËÖµÓÐÐ§£©
 170   2            TMR3CN=4;   
 171   2          }                
 172   1       else  //Âö³å´®Êä³öµÍµçÆ½
 173   1          {cfmc_jx=1;
 174   2           TMR3CN=0;
 175   2           TMR3RLL=0X88;TMR3RLH=0XFF;   //¸ßµçÆ½¶¨Ê±120us £¨Ð´Èë×°ÔØ¼Ä´æÆ÷£©
 176   2           TMR3CN=4;
 177   2          }
 178   1       }
 179          
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 4   

 180           
 181          /*--------=---------------------------------
 182          -----º¯ÊýÃû³Æ£º jisuan
 183          -----¹¦ÄÜÃèÊö£º ÏÔÊ¾ADC²ÉÑù
 184          -----Êä    Èë£º ÎÞ
 185          -----Êä    ³ö£º ÎÞ
 186          ------------------------------------------*/  
 187          void jisuan(void)
 188          { uchar  i;
 189   1        uint   data dl,temp;
 190   1        ulong  data temp_data;
 191   1        
 192   1      //--------¼ÆËãabÆ½¾ùÖµ¼°Ð£×¼Öµ-----------------------------------
 193   1        temp_data=0;
 194   1        for(i=0;i<=39;i++)  {EA=0;dl=ax_dl[i];EA=1;temp_data+=dl;}
 195   1        pj_dl[0]=(uint)(temp_data/40);              
 196   1        if(pj_dl[0]<=3) pj_dl[0]=0;      
 197   1        axdl_jz=pj_dl[0];    
 198   1               
 199   1        temp_data=0;
 200   1        for(i=0;i<=39;i++) {EA=0;dl=bx_dl[i];EA=1;temp_data+=dl;}
 201   1        pj_dl[1]=(uint)(temp_data/40);                   
 202   1        if(pj_dl[1]<=3) pj_dl[1]=0;
 203   1        bxdl_jz=pj_dl[1];   
 204   1      
 205   1        temp=0;
 206   1        for(i=1;i<=7;i++)  {dl=axdl_xs[i-1]=axdl_xs[i];temp+=dl;}
 207   1        dl=axdl_xs[7]=axdl_jz;
 208   1        temp+=dl;
 209   1        axdl_bcd=bcd_tran(temp/8);//ÏÔÊ¾AÏàADCÖµ
 210   1                      
 211   1        //----b----------------------     
 212   1        temp=0;
 213   1        for(i=1;i<=7;i++) {dl=bxdl_xs[i-1]=bxdl_xs[i];temp+=dl;}
 214   1        dl=bxdl_xs[7]=bxdl_jz;
 215   1        temp+=dl;
 216   1        bxdl_bcd=bcd_tran(temp/8);//ÏÔÊ¾BÏàADCÖµ
 217   1      }
 218           
 219          
 220          /*----------------------------------------
 221          -----º¯ÊýÃû³Æ£º leng
 222          -----¹¦ÄÜÃèÊö£º ÀäÆô¶¯³õÊ¼»¯
 223          -----Êä    Èë£º ÎÞ
 224          -----Êä    ³ö£º ÎÞ
 225          ------------------------------------------*/ 
 226          void leng(void)
 227          {uchar i;
 228   1        //uint js; 
 229   1        
 230   1        EMI0CF=EM_DATA;
 231   1        port_cz();  //¶Ë¿ÚÖØÖÃ
 232   1        chufa_off();  //¹Ø±Õ¶Ë¿Ú¡¢Çå´¥·¢±êÖ¾
 233   1        EA=0;WDT();
 234   1        
 235   1        ERR_JDQ=1;   //³õÊ¼»¯,¹ÊÕÏ´¥µã±ÕºÏ
 236   1        RUN_JDQ=0;      //³õÊ¼»¯£¬ÔËÐÐ¶Ï¿ª
 237   1        PL_JDQ=0;       //³õÊ¼»¯£¬ÅÔÂ·¶Ï¿ª
 238   1        zt=0x55;
 239   1        
 240   1        //--ÇåµçÁ÷µ¥Ôª------
 241   1       for(i=0;i<40;i++)   ax_dl[i]=bx_dl[i]=0;
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 5   

 242   1       axdl_jz=bxdl_jz=0;
 243   1       axdl_bcd=bxdl_bcd=0;   
 244   1       re_hf=0;                   //ÇåÈÈ»Ö¸´±êÖ¾
 245   1       adc_amp=2;
 246   1       CS4053=1; TD4053=1; //ÔË·Å8±¶ÔöÒæ
 247   1       
 248   1       //-----ÏÈÆô¶¯t3  ²úÉú¸ºÑ¹ ÓÃ7660ºó¿ÉÈ¥µô
 249   1       IE=0X80;EIE1=0X80; //¿ªT3,¿ªÈ«¾Ö
 250   1       TMR3CN|=4;         //ÖØÖÁt3ÔËÐÐ
 251   1       //-------lcd³õÊ¼»¯--------------
 252   1       for(i=0;i<6;i++)  {delay_10us(1000); WDT();}
 253   1      
 254   1       lcd_init(); WDT();//lcd³õÊ¼»¯
 255   1       lcd_command_w(0x24);       //½øÈëÀ©Õ¹Ö¸Áî
 256   1       delay_10us(LCD_W_TIME);
 257   1       lcd_command_w(0x30);              //·µ»Ø»ù±¾Ö¸Áî 
 258   1      }
 259          
 260          
 261          /*------------------------------------------------------------------
 262          -----º¯ÊýÃû³Æ£º stop_cl
 263          -----¹¦ÄÜÃèÊö£º Í£³µ×´Ì¬´¦Àí
 264          -----Êä    Èë£º ÎÞ
 265          -----Êä    ³ö£º ÎÞ
 266          --------------------------------------------------------------------*/
 267          void stop_cl(void)
 268          {uchar  js=0;
 269   1                           //¶Ë¿ÚÖØÖÃ
 270   1        chufa_off();  //¹Ø±Õ¶Ë¿Ú¡¢Çå´¥·¢±êÖ¾
 271   1        time_2500us=0;
 272   1        do
 273   1         {EMI0CF=EM_DATA;
 274   2          port_cz();                       //¶Ë¿ÚÖØÖÃ
 275   2          chufa_off();  //¹Ø±Õ¶Ë¿Ú¡¢Çå´¥·¢±êÖ¾
 276   2          WDT();
 277   2          PCA0CPM0=PCA0CPM1=PCA0CPM2=PCA0CPM3=0;  //PCA¹Ø±Õ
 278   2          TR0=TR1=TR2=0;                  //T0,1,2¹Ø±Õ
 279   2          zt=0x55;
 280   2          IE=0X80; EIE1=0X80;//¿ªT3£¬È«¾ÖÖÐ¶Ï
 281   2          TMR3CN|=4;         //T3ÔËÐÐ
 282   2        
 283   2          if(time_2500us>=30)  //80msÖ´ÐÐ1´Î
 284   2            {time_2500us=0;
 285   3             jisuan();  
 286   3            }
 287   2            
 288   2         STP=1;
 289   2         if(STP==0)  {if(++js>20) zt=0x5a;} //Æð¶¯µ÷Ñ¹¿ªÊ¼
 290   2         else        {js=0;} 
 291   2         hm_cl(0);  
 292   2       }while(zt==0x55);         //ÅÐ¶ÏÆô¶¯ Èç¹û¼üÅÌ×´Ì¬²»ÊÇÖ÷»­Ãæ£¬²»Æô¶¯ £¬¹ÊÕÏÓÅÏÈÍË³ö     
 293   1      }
 294          
 295          
 296          /*-----------------------------------------
 297          -----º¯ÊýÃû³Æ£º start_cl
 298          -----¹¦ÄÜÃèÊö£º Æð¶¯×´Ì¬´¦Àí
 299          -----Êä    Èë£º ÎÞ
 300          -----Êä    ³ö£º ÎÞ
 301          ------------------------------------------*/
 302          void start_cl(void)
 303          {uchar js1,js2,js3;
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 6   

 304   1      
 305   1          //BXDY_TB=CXDY_TB=1;
 306   1         // AXDL_TB=BXDL_TB=CXDL_TB=1;
 307   1         // PCA0CN=0;
 308   1         // PCA0CPL3=PCA0L-1;PCA0CPH3=PCA0H-1; //ÏÂ´ÎÆ¥ÅäÊ±¼ä·ÅÖÃ×î´ó£¬ÒÔÃâ¿ªÖÐ¶Ïºó·¢ÉúÒâÍâÖÐ¶Ï
 309   1         // PCA0MD=0;PCA0CPM0=0x11;PCA0CPM3=0x49;//³õÊ¼»¯pca 
 310   1         // TMR3RLL=0X3C;TMR3RLH=0XF6;TMR3CN=4;    //t3Æð¶¯
 311   1         // PCA0CN=0;TR0=TR1=TR2=0;TCON=5;TMR2CN=0;
 312   1                
 313   1          time_2500us=0;  js1=js2=js3=0;
 314   1          //--- Æô¶¯Ñ­»· ------------------
 315   1          do
 316   1           {EMI0CF=EM_DATA;
 317   2            port_cz();  //¶Ë¿ÚÖØÖÃ
 318   2            WDT();
 319   2            EIP2=ZD_IP2;EIP1=ZD_IP1;IP=ZD_IP0;  //ÖÐ¶ÏÓÅÏÈ¼¶ T3×î¸ß
 320   2            ESPI0=ES0=EX1=0;
 321   2            zt=0x5a;       
 322   2       
 323   2            if(time_2500us>=30)  //80msÖ´ÐÐ1´Îa¼ÆËã
 324   2              { time_2500us=0;
 325   3                jisuan(); //¼ÆËã
 326   3                hm_cl(0); 
 327   3              }
 328   2              
 329   2         //---------------ÏòÉÏ£¬¼ÓÑ¹----------------
 330   2         UP=1;
 331   2         if(UP==0&&DOWN==1)  {if(++js1>20) {}}
 332   2         else                {js1=0;} 
 333   2         
 334   2         //---------------ÏòÏÂ£¬¼õÑ¹----------------
 335   2         DOWN=1;
 336   2         if(DOWN==0&&UP==1)  {if(++js2>20) {}}
 337   2         else                {js2=0;} 
 338   2         
 339   2        //--------------Í£Ö¹ÍË³ö-------------
 340   2         if(STP)  {if(++js3>20) zt=0x55;}
 341   2         else     {js3=0;} 
 342   2        }while(zt==0x5a);         //Æô¶¯×´Ì¬¼ÌÐøÑ­»·                          
 343   1      }
 344          
 345                  
 346          /*-----------------------------------------
 347          -----º¯ÊýÃû³Æ£º uint adc_start(uchar)
 348          -----¹¦ÄÜÃèÊö£º adc²ÉÑù
 349          -----Êä    Èë£º Í¨µÀºÅ,²ÉÑùµÈ´ýÊ±¼ä1=1us×óÓÒ
 350          -----Êä    ³ö£º ×ª»»½á¹û
 351          ------------------------------------------*/ 
 352          uint adc_start(uchar td,uchar mode)
 353          {
 354   1       union  w_b adc_jg;
 355   1       uchar  js;
 356   1        
 357   1        REF0CN=3;     //Ñ¡ÔñÄÚ²¿»ù×¼¡¢³õÊ¼»¯¶Ë¿ÚÊ±ÒÑÑ¡Ôñ
 358   1        AMX0P=td;     //Ñ¡ÔñÍ¨µÀ
 359   1        AMX0N=0x1f;      //¸º¶Ë½ÓµØ¡¢µ¥¶Ë×ª»»
 360   1        ADC0CF=mode;  //0X28;  //2MhzÊ±ÖÓ¡¢ÓÒ¶ÔÆë  0x2c×ó¶ÔÆë
 361   1        ADC0CN=0X80;  //ADC×¼±¸
 362   1         _nop_();_nop_();_nop_();_nop_();
 363   1         _nop_();_nop_();_nop_();_nop_();  //µÈ´ý±£³ÖµçÈÝ³äµç Ô¼1us
 364   1        AD0BUSY=1;     //Æô¶¯×ª»»
 365   1        for(js=0;js<40;js++)
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 7   

 366   1           {if(AD0INT==1) {adc_jg.data_b[0]=ADC0H;
 367   3                         adc_jg.data_b[1]=ADC0L; break;} //×ª»»ÍêÌø³ö      
 368   2          else ;   
 369   2          }
 370   1      
 371   1        return(adc_jg.data_w);
 372   1      }
 373          
 374          
 375          /*--------------------------------------
 376          ¿´ÃÅ¹·³õÊ¼»¯º¯Êý
 377          ------------------------------------*/ 
 378          void wdt_initi(void)
 379          {
 380   1        PCA0MD=0;      //¹Ø±ÕWDT 
 381   1        PCA0CPL4=200;   //1/12Ê±ÖÓÔ´Ê± 1=256us  12mhz
 382   1        PCA0MD=1<<WDTE; //Ñ¡Ôñ1/12Ê±ÖÓÔ´  ²¢Æô¶¯¿´ÃÅ¹·
 383   1        PCA0MD|=1<<WDLCK;  //Ëø¶¨¿´ÃÅ¹·
 384   1        _nop_();
 385   1        PCA0CPH4=0;   //¸üÐÂ
 386   1      }
 387          
 388          
 389          
 390          /*------------------------------------------
 391           vdd¼à¿ØÆ÷³õÊ¼»¯¡¢¼°¸´Î»Ô´Ñ¡Ôñº¯Êý
 392           ÄÚÓÐÑÓ³Ù
 393          -----------------------------------------*/ 
 394          void vdd_rst_init(void)
 395          {
 396   1        VDM0CN|=0X80;   //Ê¹ÄÜVDD¼à¿Ø
 397   1        delay_10us(14); //140usÑÓ³Ù
 398   1        RSTSRC=1<<MCDRSF|1<<PORSF;//Ê¹ÄÜÊ±ÖÓ¶ªÊ§¼ì²â¡¢ÉÏµç¸´Î»£¨vdd£©
 399   1        REG0CN=0X80;   //¹Ø±ÕÎÈÑ¹Æ÷
 400   1      }
 401          
 402          /*-------------------------------------------
 403             Ê±¼äÑÓ³Ùº¯Êý (12mhzÊ±1=10us)
 404          ------------------------------------------*/ 
 405          void delay_10us(uint t)
 406          {
 407   1        uchar i;
 408   1        uint  j;
 409   1        for(j=0;j<t;j++)
 410   1          {
 411   2          for(i=0;i<10;i++)  //±¾Ñ­»·Ô¼9.914us
 412   2            { _nop_();_nop_();_nop_();_nop_();}
 413   2        }
 414   1      }
 415             
 416          
 417          /*--------------------------------------
 418          //IO¿ÚÅäÖÃ¸ü¸Ä 
 419          --------------------------------------*/ 
 420          void port_initi(void) //V3.0
 421          { 
 422   1        P0MDIN= 0xff;    
 423   1        P0MDOUT=0x3f;   //P0.0~0.5(´¥·¢),ÍÆÍì,P0.6,P0.7(Í¬²½ÊäÈë),¿ªÂ©
 424   1        P0SKIP= 0xff;   //È«Ìø¹ý
 425   1        P0=0xc0;        //P0.0~0.5£¬³õÊ¼»¯µÍ£¬NPNÕýÇý
 426   1      
 427   1        P1MDIN =0Xdf;   
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 8   

 428   1        P1MDOUT=0xd8;   //P1.0~P1.2(Í¬²½),¿ªÂ©, P1.3 P1.4,P1.6(Òº¾§Çý¶¯),ÍÆÍì,P1.5(Íâ²Î¿¼)Ä£Äâ P1.7(CON)ÍÆÍì
 429   1        P1SKIP =0Xf8;   //Ìø¹ýP1.3~P1.7 , P1.0~1.2·ÖÅä¸øPCA0~2
 430   1        P1=0xff;        
 431   1      
 432   1        P2MDIN =0Xff;   
 433   1        P2MDOUT=0x73;   //P2.0(TXD1),P2.1(RXD1)ÍÆÍì ,P2.2(Â©µç¼ì²â) P2.3 (Â©µç±£»¤¼ÌµçÆ÷)¿ªÂ©,2.4~2.6¼ÌµçÆ÷Çý¶¯Í
             -ÆÍì P2.7ÆôÍ£ ¿ªÂ©
 434   1        P2SKIP =0x00;   //P2.0,P2.1·ÖÅä¸øTX1,RX1
 435   1        P2=0X8f;        //2.4,2.5,2.6¼ÌµçÆ÷ÉÏµçµÍ
 436   1          
 437   1        P3MDIN =0Xff;  
 438   1        P3MDOUT=0Xe0;   //P3.0~P3.4 ¿ª¹ØÁ¿ÊäÈë,¿ªÂ©  P3.5(ÌúµçSCK) ÍÆÍì,P3.6,3.7 ¶àÂ·¿ª¹Ø,ÍÆÍì
 439   1        P3=0xff;      
 440   1      
 441   1        P4MDIN =0X86;   
 442   1        P4MDOUT=0x86;   //P4.0,4.3~P4.6Ä£Äâ P4.1,P4.2,P4.7Ìúµç ÍÆÍì
 443   1        P4=0xff;    
 444   1        
 445   1        XBR0=0;          
 446   1        XBR2=1;         //UART1Á¬½Ó 
 447   1        XBR1=0X43;      //Ê¹ÄÜ½»²æ¿ª¹Ø¡¢ÔÊÐíPCA0-2
 448   1      
 449   1        IT01CF=0X76;    //int0=p0.6 int1=p0.7 µÍµçÆ½ÓÐÐ§
 450   1        REF0CN=3;       //Ê¹ÄÜÄÚ²¿µçÑ¹»ù×¼£¨ÒÑÔÚÆð¶¯adcÊ±ÖØÖÃ£©
 451   1      }
 452          
 453            
 454          
 455          /*--------------------------------------
 456             ¶Ë¿Ú¼°¼Ä´æÆ÷ÖØÖÃ   V3.0
 457          --------------------------------------*/
 458          void port_cz(void)   //V3.0
 459          { 
 460   1        P0MDIN= 0xff;    
 461   1        P0MDOUT=0x3f;  
 462   1        P0SKIP= 0xff;   
 463   1      
 464   1        P1MDIN =0Xdf;   
 465   1        P1MDOUT=0xd8;   
 466   1        P1SKIP =0Xf8;   
 467   1      
 468   1        P2MDIN =0Xff;   
 469   1        P2MDOUT=0x73;   
 470   1        P2SKIP =0x00;
 471   1          
 472   1        P3MDIN =0Xff;  
 473   1        P3MDOUT=0Xe0;   
 474   1                  
 475   1        P4MDIN =0x86;  
 476   1        P4MDOUT=(P4MDOUT|0X83)&0x86;   //xxxxxxxxxxxxxxxxxxxxxxx  P4.2ÐèÒª±ä»¯
 477   1      
 478   1        XBR0=0;          
 479   1        XBR2=1;          //UART1Á¬½Ó 
 480   1        XBR1=0X43;       //Ê¹ÄÜ½»²æ¿ª¹Ø¡¢ÔÊÐíPCA0-2
 481   1      
 482   1        IT01CF=0X76;     //int0=p0.6 int1=p0.7 µÍµçÆ½ÓÐÐ§
 483   1        osc_init();      //ÖØÖÃÕñµ´Æ÷
 484   1        vdd_rst_init();  //ÖØÖÃvdd¼à¿Ø¼°¸´Î»Ô´¼°¹Ø±ÕÎÈÑ¹Æ÷
 485   1      }
 486          
 487          
 488          //-------------------------------------
C51 COMPILER V9.54   MAIN                                                                  05/14/2022 08:03:43 PAGE 9   

 489          //Õñµ´Æ÷³õÊ¼»¯
 490          //----------------------------------
 491          void osc_init(void)
 492          { 
 493   1        OSCICN=0X83;   //Ê¹ÄÜÄÚ²¿Õñµ´Æ÷²»·ÖÆµ  12mhz
 494   1        OSCLCN=0;      //&=~0X80; //¹Ø±ÕÄÚ²¿µÍÆµÕñµ´Æ÷
 495   1        OSCXCN=0;      //¹Ø±ÕÍâ²¿Õñµ´Æ÷
 496   1        CLKMUL=0;      //¹Ø±Õ³Ë·¨Æ÷
 497   1        CLKSEL=0;      //USBÎª4±¶³Ë·¨Æ÷£¬ÄÚ²¿Õñµ´Æ÷×÷ÎªÏµÍ³Ê±ÖÓ
 498   1        CKCON=0;       //¶¨Ê±Æ÷Ê±ÖÓÔ´²»ÊÇÏµÍ³Ê±ÖÓÓÉ¿ØÖÆÆ÷¼Ä´æÆ÷Ñ¡Ôñ
 499   1      } 
 500              
 501          //----------------------------------------------
 502          //---bcd×ª»»
 503          //-----------------------------------
 504          uint bcd_tran(uint value)
 505          { uint temp=0;
 506   1        if(value<10000)
 507   1         {while(value>=1000) {temp+=0x1000;value-=1000;}
 508   2          while(value>=100)  {temp+=0x100;value-=100;}
 509   2          while(value>=10)   {temp+=0x10;value-=10;}
 510   2          temp+=value;}
 511   1        else temp=value;
 512   1        return(temp);
 513   1      }
 514          
 515          //-------------------------------------------------
 516          //---¹Ø±Õ´¥·¢¡¢Çå´¥·¢±êÖ¾
 517          //--------------------------------
 518          void chufa_off(void)
 519          {  SPRING_A=0; SPRING_B=0; SPRING_C=0;
 520   1         SPRING_AF=0;SPRING_BF=0;SPRING_CF=0;  //´¥·¢¶Ë¿ÚÖÃÎÞÐ§
 521   1      }
 522               


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3227    ----
   CONSTANT SIZE    =    108    ----
   XDATA SIZE       =    192      29
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
